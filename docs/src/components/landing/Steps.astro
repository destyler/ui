---
import { highlight } from '../../utils/shiki'

/**
 * How It Works — numbered steps layout with staggered alignment.
 * Code blocks switch between Vue and React based on [data-framework] on <html>.
 */
const steps = [
  {
    number: "01",
    title: "Install the package",
    description: "Add Destyler to your project with your preferred package manager. Zero config, no build plugins required.",
    vue: { code: "pnpm add @destyler-ui/vue", lang: "shellscript" as const },
    react: { code: "pnpm add @destyler-ui/react", lang: "shellscript" as const },
  },
  {
    number: "02",
    title: "Import components",
    description: "Pull in exactly what you need. Every component is tree-shakable through namespace exports or direct imports.",
    vue: { code: "import { Collapse } from '@destyler-ui/vue'", lang: "typescript" as const },
    react: { code: "import { Collapse } from '@destyler-ui/react'", lang: "typescript" as const },
  },
  {
    number: "03",
    title: "Style your way",
    description: "Apply your design tokens, Tailwind classes, or CSS-in-JS. The components provide behavior — you provide the look.",
    vue: {
      code: `<Collapse.Root>\n  <Collapse.Item value="a">\n    ...\n  </Collapse.Item>\n</Collapse.Root>`,
      lang: "vue-html" as const,
    },
    react: {
      code: `<Collapse.Root>\n  <Collapse.Item value="a">\n    ...\n  </Collapse.Item>\n</Collapse.Root>`,
      lang: "tsx" as const,
    },
  },
];

// Pre-render highlighted HTML for each step
const highlightedSteps = await Promise.all(
  steps.map(async (step) => ({
    ...step,
    vueHtml: await highlight(step.vue.code, step.vue.lang),
    reactHtml: await highlight(step.react.code, step.react.lang),
  }))
)
---

<section class="py-20 px-6 md:py-28 md:px-12 lg:py-40 lg:px-16 border-b border-$sl-color-hairline overflow-visible!">
  <div class="max-w-[1200px] mx-auto overflow-visible!">
    <!-- Section header -->
    <div class="mb-16 md:mb-24">
      <p class="font-code text-xs font-semibold tracking-[0.2em] uppercase text-$sl-color-accent mb-6">GETTING STARTED</p>
      <h2 class="font-display font-bold tracking-[-0.04em] leading-[1.1] text-$sl-color-text text-[2.5rem] md:text-[3.5rem] lg:text-[4.5rem] mb-6">
        Three steps to<br />
        ship faster
      </h2>
    </div>

    <!-- Steps -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 lg:gap-10">
      {highlightedSteps.map((step) => (
        <div class="group relative overflow-visible!">
          <span class="block font-display font-black text-[4rem] md:text-8xl tracking-[-0.06em] leading-[1.15] text-$sl-color-hairline mb-6 transition-colors duration-150 ease-out overflow-visible! group-hover:text-$sl-color-accent">{step.number}</span>
          <div>
            <h3 class="font-display font-bold text-xl tracking-[-0.02em] text-$sl-color-text mb-3 leading-[1.25]">{step.title}</h3>
            <p class="text-sm leading-[1.6] text-$sl-color-gray-3 tracking-[-0.01em] mb-6">{step.description}</p>
            <div class="step-code mt-4">
              <div class="ds-code-vue">
                <Fragment set:html={step.vueHtml} />
              </div>
              <div class="ds-code-react">
                <Fragment set:html={step.reactHtml} />
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  /* Toggle code blocks based on selected framework */
  :root[data-framework='vue'] .ds-code-vue,
  :root:not([data-framework]) .ds-code-vue {
    display: block;
  }
  :root[data-framework='vue'] .ds-code-react,
  :root:not([data-framework]) .ds-code-react {
    display: none;
  }
  :root[data-framework='react'] .ds-code-vue {
    display: none;
  }
  :root[data-framework='react'] .ds-code-react {
    display: block;
  }

  .step-code :global(.shiki) {
    font-family: var(--sl-font-mono) !important;
    font-size: 0.8125rem !important;
    line-height: 1.6 !important;
    border: 1px solid var(--sl-color-hairline) !important;
    padding: 1rem 1.25rem !important;
    overflow-x: auto;
    margin: 0 !important;
    border-radius: 0.375rem !important;
  }

  .step-code :global(.shiki code) {
    font-family: inherit !important;
    background: none !important;
    padding: 0 !important;
    border: none !important;
    font-size: inherit !important;
  }

  /* Shiki dual-theme: vitesse-dark / vitesse-light */
  :root[data-theme='dark'] .step-code :global(.shiki),
  :root:not([data-theme]) .step-code :global(.shiki) {
    background-color: var(--shiki-dark-bg, #121212) !important;
    color: var(--shiki-dark, #dbd7caee) !important;
  }

  :root[data-theme='dark'] .step-code :global(.shiki span),
  :root:not([data-theme]) .step-code :global(.shiki span) {
    color: var(--shiki-dark) !important;
  }

  :root[data-theme='light'] .step-code :global(.shiki) {
    background-color: var(--shiki-light-bg, #ffffff) !important;
    color: var(--shiki-light, #393a34) !important;
  }

  :root[data-theme='light'] .step-code :global(.shiki span) {
    color: var(--shiki-light) !important;
  }
</style>
