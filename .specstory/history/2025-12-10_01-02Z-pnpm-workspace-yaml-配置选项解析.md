<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- vscode Session a42f6a49-492c-4cfd-a643-ffd21db2c24f (2025-12-10 01:02Z) -->

# pnpm-workspace.yaml 配置选项解析 (2025-12-10 01:02Z)

_**User (2025-12-10 01:03Z)**_

我想知道 我们 #file:pnpm-workspace.yaml 中的

```
catalogMode: prefer
shellEmulator: true
trustPolicy: no-downgrade
```

有啥用啊

---

_**Agent (model copilot/claude-opus-4.5)**_

这三个配置是 pnpm 工作区的高级设置，让我为你解释每个选项的作用：

## `catalogMode: prefer`

这是 **pnpm catalogs** 功能的配置。Catalogs 允许你在 `pnpm-workspace.yaml` 中集中定义依赖版本（就像你文件中的 `catalogs:` 部分），然后在各个 `package.json` 中引用它们。

- `prefer` 模式意味着：当 `package.json` 中声明的版本与 catalog 中定义的版本不一致时，**优先使用 catalog 中的版本**
- 这样可以确保整个 monorepo 中依赖版本的一致性

## `shellEmulator: true`

启用 pnpm 的 **内置 shell 模拟器**：

- 让 `pnpm run` 脚本在所有平台上以一致的方式运行
- 避免 Windows/macOS/Linux 之间的 shell 命令兼容性问题
- 例如，像 `&&`、`||`、环境变量设置等语法在所有系统上都能正常工作

## `trustPolicy: no-downgrade`

这是 pnpm 的**安全策略**设置：

- `no-downgrade` 意味着：**不允许将已安装的包降级到更低版本**
- 这是一种防护措施，防止供应链攻击（恶意包发布者可能会尝试让用户降级到包含漏洞的旧版本）
- 如果检测到降级尝试，pnpm 会阻止并报错

---

**总结**：这三个配置分别用于：
1. 📦 集中管理依赖版本
2. 🐚 跨平台脚本兼容性
3. 🔒 安全防护

---

